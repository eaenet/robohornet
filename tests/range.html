<!DOCTYPE html>
<html>
<head>
  <title>DOM Range API</title>
  <script>

      var DEFAULT_ITERATIONS = 100;
      var BODY_HTML = generateHtml(100, true /** opt_withIds */);
      var REPLACEMENT_HTML = generateHtml(100);

      function reset() { document.body.innerHTML = BODY_HTML; }
      function setUp() { reset(); }

      function test(opt_times) {
        // Replace a section of the DOM using the Range API.
        // Inspired by metamorph.js.
        var times = opt_times || DEFAULT_ITERATIONS;
        var start = document.getElementById('node' + Math.floor(times * 0.1));
        var end = document.getElementById('node' + Math.floor(times * 0.9));
        var r = document.createRange();
        for (var i = 0; i < times; i++) {
          r.setStartAfter(start);
          r.setEndBefore(end);
          r.deleteContents();
          r.insertNode(r.createContextualFragment(REPLACEMENT_HTML));
        }
      }

      function generateHtml(nodes, opt_withIds) {
        var lorem =
            'Cupcake ipsum dolor sit amet icing carrot cake gummi ' +
            'bears jelly. Sugar plum sesame snaps candy canes.';
        var s = '';
        for (var i = 0; i < nodes; i++) {
          s += '<p id=node' + (opt_withIds ? i : '') + '>' + lorem + '</p>';
        }
        return s;
      }

    </script>
  </head>
  <body></body>
  <script src="../test.js"></script>
</html>
